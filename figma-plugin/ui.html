<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>test-cursor-2</title>
    <style>
      body { font-family: Inter, ui-sans-serif, system-ui, -apple-system; margin: 0; }
      .container { padding: 12px; display: flex; flex-direction: column; gap: 12px; }
      .card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; }
      .row { display: flex; gap: 8px; align-items: center; }
      label { font-size: 12px; color: #374151; }
      input, select { flex: 1; padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; }
      button { padding: 8px 10px; border: none; border-radius: 6px; background: #111827; color: white; cursor: pointer; }
      button.secondary { background: #f3f4f6; color: #111827; }
      pre { background: #0b1020; color: #e5e7eb; padding: 8px; border-radius: 6px; max-height: 160px; overflow: auto; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card" style="display:flex;align-items:center;justify-content:center">
        <img alt="Cover" width="320" height="120"
             src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='320' height='120' viewBox='0 0 320 120'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='%23509ED8'/><stop offset='100%' stop-color='%23F1582A'/></linearGradient><linearGradient id='bg' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='%2310202b'/><stop offset='100%' stop-color='%230b1020'/></linearGradient></defs><rect width='320' height='120' rx='12' fill='url(%23bg)'/><g transform='translate(20,22)'><rect x='0' y='0' width='56' height='56' rx='12' fill='url(%23g)'/><circle cx='28' cy='28' r='10' fill='white' opacity='0.25'/><rect x='76' y='6' width='210' height='14' rx='7' fill='%23e5e7eb'/><rect x='76' y='28' width='160' height='10' rx='5' fill='%23899aa9'/></g><g transform='translate(20,86)'><rect x='0' y='0' width='280' height='8' rx='4' fill='%23222f3e'/></g><text x='20' y='110' font-family='Inter, Arial' font-size='12' fill='%23cbd5e1'>test-cursor-2 • Toolkit</text></svg>"/>
      </div>

      <div class="card">
        <strong>Renommer les calques (selection)</strong>
        <div class="row">
          <input id="find" placeholder="Rechercher (ex: Copy)" />
          <input id="replace" placeholder="Remplacer par (ex: Body)" />
        </div>
        <button id="btn-rename">Renommer</button>
      </div>

      <div class="card">
        <strong>Remplacer la police (selection)</strong>
        <div class="row">
          <input id="findFamily" placeholder="Police à remplacer (ex: Space Grotesk)" />
        </div>
        <div class="row">
          <input id="replaceFamily" placeholder="Nouvelle police (ex: Poppins)" />
          <input id="fontStyle" placeholder="Style (Regular/Bold...)" />
        </div>
        <button id="btn-font">Remplacer la police</button>
      </div>

      <div class="card">
        <strong>Extraire couleurs → Tokens</strong>
        <div class="row">
          <button id="btn-tokens">Extraire</button>
          <button id="btn-copy" class="secondary">Copier JSON</button>
        </div>
        <pre id="output">[]</pre>
      </div>

      <div class="card">
        <strong>Exporter SVG (selection)</strong>
        <div class="row">
          <button id="btn-export">Exporter</button>
          <button id="btn-save" class="secondary">Télécharger .zip</button>
        </div>
        <pre id="exports"></pre>
      </div>

      <div class="card">
        <strong>Auto Layout (selection)</strong>
        <div class="row">
          <input id="itemSpacing" placeholder="Gap (itemSpacing)" type="number" />
        </div>
        <div class="row">
          <input id="paddingX" placeholder="Padding X" type="number" />
          <input id="paddingY" placeholder="Padding Y" type="number" />
        </div>
        <div class="row">
          <input id="paddingLeft" placeholder="Padding Left" type="number" />
          <input id="paddingRight" placeholder="Padding Right" type="number" />
        </div>
        <div class="row">
          <input id="paddingTop" placeholder="Padding Top" type="number" />
          <input id="paddingBottom" placeholder="Padding Bottom" type="number" />
        </div>
        <button id="btn-autolayout">Appliquer Auto Layout</button>
      </div>

      <div class="row">
        <button id="btn-close" class="secondary">Fermer</button>
      </div>
    </div>

    <script>
      const $ = (id) => document.getElementById(id)
      const state = { tokens: [], exports: [] }
      window.onmessage = (event) => {
        const msg = event.data.pluginMessage
        if (!msg) return
        if (msg.type === 'tokens') { state.tokens = msg.payload || []; $('output').textContent = JSON.stringify(state.tokens, null, 2) }
        if (msg.type === 'exports') { state.exports = msg.payload || []; $('exports').textContent = state.exports.map(e => `• ${e.name}.svg`).join('\n') }
      }
      $('btn-rename').onclick = () => { parent.postMessage({ pluginMessage: { type: 'rename', payload: { find: $('find').value || '', replace: $('replace').value || '' } } }, '*') }
      $('btn-font').onclick = () => { parent.postMessage({ pluginMessage: { type: 'replaceFonts', payload: { findFamily: $('findFamily').value || '', replaceFamily: $('replaceFamily').value || '', style: $('fontStyle').value || 'Regular' } } }, '*') }
      $('btn-tokens').onclick = () => { parent.postMessage({ pluginMessage: { type: 'extractTokens' } }, '*') }
      $('btn-copy').onclick = async () => { await navigator.clipboard.writeText(JSON.stringify(state.tokens, null, 2)) }
      $('btn-export').onclick = () => { parent.postMessage({ pluginMessage: { type: 'exportSVG' } }, '*') }
      $('btn-save').onclick = async () => { const blob = new Blob(state.exports.map(e => e.data), { type: 'text/plain' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'icons.svg.txt'; a.click(); URL.revokeObjectURL(url) }
      $('btn-close').onclick = () => { parent.postMessage({ pluginMessage: { type: 'close' } }, '*') }

      $('btn-autolayout').onclick = () => {
        const v = (id) => {
          const t = $(id).value
          return t === '' ? undefined : Number(t)
        }
        parent.postMessage({ pluginMessage: { type: 'setAutoLayout', payload: {
          itemSpacing: v('itemSpacing'),
          paddingX: v('paddingX'),
          paddingY: v('paddingY'),
          paddingLeft: v('paddingLeft'),
          paddingRight: v('paddingRight'),
          paddingTop: v('paddingTop'),
          paddingBottom: v('paddingBottom')
        }} }, '*')
      }
    </script>
  </body>
  </html>


